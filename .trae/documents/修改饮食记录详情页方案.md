# 修改「饮食记录详情」页面方案

## 1. Core Data 数据模型更新
为了持久化存储每日的活动热量，需要在 `DietRecord` 实体中增加字段。
- **修改文件**: `MuscleMetric.xcdatamodeld/MuscleMetric.xcdatamodel/contents`
- **操作**: 为 `DietRecord` 实体添加 `activeEnergy` 属性，类型为 `Double`，默认值为 0.0。
- **修改代码**: 在 `DietRecord+CoreDataClass.swift` 中添加对应的 `@NSManaged` 属性。

## 2. HealthKit 集成
- **权限配置**: 修改 `project.pbxproj`，在 Build Settings 中添加 HealthKit 权限描述：
    - `NSHealthShareUsageDescription`: "我们需要读取您的活动能量以计算热量缺口。"
    - `NSHealthUpdateUsageDescription`: "我们需要访问您的健康数据。"
- **创建管理器**: 新建 `MuscleMetric/Managers/HealthKitManager.swift`。
    - 实现单例 `HealthKitManager`。
    - 提供 `requestAuthorization()` 方法请求权限。
    - 提供 `fetchActiveEnergy(date:completion:)` 方法获取指定日期的活动热量。

## 3. UI 组件重构与更新
### 3.1 饮食概要视图 (DietSummaryView)
- **重构**: 将 `DietSummaryView` 从 `AddDietRecordView.swift` 中提取为独立文件 `MuscleMetric/Views/DietRecord/DietSummaryView.swift`。
- **新增功能**:
    - 增加 `bmr` (基础代谢) 和 `activeEnergy` (活动热量) 参数。
    - 增加「热量缺口」计算逻辑：`基础代谢 + 活动热量 - 摄入热量`。
    - 增加「热量缺口」展示项，正数显示绿色，负数显示红色。

### 3.2 饮食记录详情页 (DietRecordDetailView)
- **数据获取**:
    - 获取 `UserProfile` 以计算 BMR (`体重 * 24`)。
    - 在 `onAppear` 中检查 `record.activeEnergy`。如果为 0，尝试从 HealthKit 获取并更新。
- **界面修改**:
    - **基本信息模块**:
        - 日期显示格式调整为 `YYYY/MM/DD 周几`。
        - 显示「基础代谢」(BMR)。
        - 显示「活动热量」，并提供刷新按钮（从 HealthKit 重新获取）和手动修改功能。
    - **概要模块**:
        - 传递 BMR 和 Active Energy 给 `DietSummaryView` 进行展示。

## 4. 实现步骤
1.  **数据层**: 修改 Core Data 模型文件和类文件。
2.  **配置层**: 更新项目文件添加 HealthKit 权限。
3.  **服务层**: 实现 `HealthKitManager`。
4.  **UI层**:
    - 提取并升级 `DietSummaryView`。
    - 修改 `DietRecordDetailView` 实现新的交互和展示逻辑。
    - 确保 `AddDietRecordView` 兼容新的 `DietSummaryView`。
